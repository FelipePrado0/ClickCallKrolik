<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Modal Erro Transcri√ß√£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(40,40,60,0.9);
            padding: 24px;
            border-radius: 16px;
        }
        .test-result {
            margin: 16px 0;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
        }
        .success {
            background: rgba(0,255,0,0.2);
            border: 1px solid rgba(0,255,0,0.5);
        }
        .error {
            background: rgba(255,0,0,0.2);
            border: 1px solid rgba(255,0,0,0.5);
        }
        button {
            background: linear-gradient(90deg, #7b0051 60%, #c8007e 100%);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 10px 24px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            margin: 8px;
        }
        .modal-confirm-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste - Modal Erro Transcri√ß√£o</h1>
        
        <div class="test-result" id="test1">
            <h3>Teste 1: Verificar se o modal aparece quando chamado</h3>
            <p id="result1">Testando...</p>
        </div>

        <div class="test-result" id="test2">
            <h3>Teste 2: Verificar se a mensagem de erro √© exibida corretamente</h3>
            <p id="result2">Testando...</p>
        </div>

        <div class="test-result" id="test3">
            <h3>Teste 3: Verificar se o modal fecha ao clicar no bot√£o OK</h3>
            <p id="result3">Testando...</p>
        </div>

        <div class="test-result" id="test4">
            <h3>Teste 4: Verificar se o modal fecha ao clicar fora dele</h3>
            <p id="result4">Testando...</p>
        </div>

        <div style="margin-top: 24px;">
            <button onclick="testarModal()">üîç Testar Modal</button>
            <button onclick="executarTestes()">üîÑ Executar Testes Novamente</button>
        </div>
    </div>

    <script>
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showTranscriptionErrorModal(errorMessage) {
            const oldModal = document.getElementById('modal-transcricao-erro');
            if (oldModal) oldModal.remove();
            const modal = document.createElement('div');
            modal.id = 'modal-transcricao-erro';
            modal.className = 'modal-confirm-bg';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = '10000';
            const mensagemEscapada = escapeHtml(errorMessage || 'Erro desconhecido');
            modal.innerHTML = `
                <div class="modal-confirm" style="
                    width: 100%;
                    max-width: 500px;
                    min-width: 320px;
                    box-sizing: border-box;
                    background: rgba(40,40,60,0.95);
                    backdrop-filter: blur(8px);
                    border-radius: 24px;
                    box-shadow: 0 12px 48px rgba(0,0,0,0.3);
                    padding: 32px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 24px;
                ">
                    <div style="
                        font-size: 3rem;
                        color: #ff4444;
                        margin-bottom: 8px;
                    ">‚ùå</div>
                    <div style="
                        font-size: 1.5rem;
                        font-weight: 700;
                        color: #fff;
                        text-align: center;
                        margin-bottom: 8px;
                    ">Erro ao transcrever √°udio</div>
                    <div style="
                        width: 100%;
                        background: rgba(255,68,68,0.1);
                        border-left: 4px solid #ff4444;
                        border-radius: 8px;
                        padding: 16px;
                        color: #ffaaaa;
                        font-size: 0.95rem;
                        line-height: 1.6;
                        word-wrap: break-word;
                        overflow-wrap: break-word;
                        text-align: left;
                        max-height: 200px;
                        overflow-y: auto;
                    ">${mensagemEscapada}</div>
                    <button id="close-modal-transcricao-erro" class="modal-btn-confirm" style="
                        width: 100%;
                        max-width: 200px;
                        font-size: 1rem;
                        padding: 12px 24px;
                        border-radius: 12px;
                        background: linear-gradient(90deg, #7b0051 60%, #c8007e 100%);
                        color: #fff;
                        font-weight: 600;
                        border: none;
                        box-shadow: 0 2px 8px rgba(123,0,81,0.3);
                        cursor: pointer;
                        transition: background 0.2s, transform 0.2s;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
            const closeBtn = document.getElementById('close-modal-transcricao-erro');
            closeBtn.onclick = () => {
                modal.remove();
            };
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            return modal;
        }

        function testarModal() {
            const mensagemErro = 'Erro HTTP 500: Servidor interno do erro';
            const modal = showTranscriptionErrorModal(mensagemErro);
            console.log('‚úÖ Modal de erro exibido com sucesso!');
            console.log('Mensagem de erro:', mensagemErro);
        }

        function executarTestes() {
            const resultado1 = document.getElementById('result1');
            const resultado2 = document.getElementById('result2');
            const resultado3 = document.getElementById('result3');
            const resultado4 = document.getElementById('result4');
            const test1 = document.getElementById('test1');
            const test2 = document.getElementById('test2');
            const test3 = document.getElementById('test3');
            const test4 = document.getElementById('test4');

            let passou1 = false;
            let passou2 = false;
            let passou3 = false;
            let passou4 = false;

            try {
                const mensagemTeste = 'Erro ao conectar com o servidor de transcri√ß√£o';
                
                const modal = showTranscriptionErrorModal(mensagemTeste);
                
                if (modal && document.getElementById('modal-transcricao-erro')) {
                    passou1 = true;
                    resultado1.textContent = '‚úÖ PASSOU: O modal aparece quando chamado';
                    test1.classList.add('success');
                    test1.classList.remove('error');
                } else {
                    resultado1.textContent = '‚ùå FALHOU: O modal n√£o apareceu';
                    test1.classList.add('error');
                    test1.classList.remove('success');
                }

                const modalContent = document.getElementById('modal-transcricao-erro');
                if (modalContent && modalContent.textContent.includes(mensagemTeste)) {
                    passou2 = true;
                    resultado2.textContent = '‚úÖ PASSOU: A mensagem de erro √© exibida corretamente';
                    test2.classList.add('success');
                    test2.classList.remove('error');
                } else {
                    resultado2.textContent = '‚ùå FALHOU: A mensagem de erro n√£o foi exibida';
                    test2.classList.add('error');
                    test2.classList.remove('success');
                }

                const closeBtn = document.getElementById('close-modal-transcricao-erro');
                if (closeBtn) {
                    passou3 = true;
                    resultado3.textContent = '‚úÖ PASSOU: O bot√£o OK existe e pode fechar o modal';
                    test3.classList.add('success');
                    test3.classList.remove('error');
                    
                    closeBtn.onclick();
                    setTimeout(() => {
                        if (!document.getElementById('modal-transcricao-erro')) {
                            passou3 = true;
                            resultado3.textContent = '‚úÖ PASSOU: O modal fecha ao clicar no bot√£o OK';
                        } else {
                            resultado3.textContent = '‚ùå FALHOU: O modal n√£o fecha ao clicar no bot√£o OK';
                            test3.classList.add('error');
                            test3.classList.remove('success');
                        }
                    }, 100);
                } else {
                    resultado3.textContent = '‚ùå FALHOU: O bot√£o OK n√£o existe';
                    test3.classList.add('error');
                    test3.classList.remove('success');
                }

                const modalTeste = showTranscriptionErrorModal('Teste de fechamento');
                setTimeout(() => {
                    if (modalTeste) {
                        modalTeste.click();
                        setTimeout(() => {
                            if (!document.getElementById('modal-transcricao-erro')) {
                                passou4 = true;
                                resultado4.textContent = '‚úÖ PASSOU: O modal fecha ao clicar fora dele';
                                test4.classList.add('success');
                                test4.classList.remove('error');
                            } else {
                                resultado4.textContent = '‚ùå FALHOU: O modal n√£o fecha ao clicar fora';
                                test4.classList.add('error');
                                test4.classList.remove('success');
                            }
                        }, 100);
                    }
                }, 100);

                console.log('‚úÖ Teste 1 (modal aparece):', passou1);
                console.log('‚úÖ Teste 2 (mensagem exibida):', passou2);
                console.log('‚úÖ Teste 3 (fecha com bot√£o):', passou3);
                console.log('‚úÖ Teste 4 (fecha ao clicar fora):', passou4);

            } catch (error) {
                console.error('‚ùå Erro ao executar testes:', error);
                resultado1.textContent = '‚ùå ERRO: ' + error.message;
                test1.classList.add('error');
            }
        }

        executarTestes();
    </script>
</body>
</html>
